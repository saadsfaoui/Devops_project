<nav class="navbar">
  <div class="navbar-container">
    <!-- Logo -->
    <div class="navbar-logo" routerLink="/" (click)="setActive('home')">
      <img
        src="logo.png"
        alt="EarthVibes logo"
        class="logo-image"
      />
      <span class="logo-text">EarthVibes</span>
    </div>

    <!-- Hamburger Menu (Mobile) -->
    <button class="hamburger" [class.active]="mobileMenuOpen()" (click)="toggleMobileMenu()">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <!-- Search Bar (visible only when on Explore page) -->
    <div class="search-container" [class.hidden]="activeNav() !== 'explore'">
      <svg class="search-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="11" cy="11" r="8"></circle>
        <path d="m21 21-4.35-4.35"></path>
      </svg>
      <input
        type="text"
        class="search-input"
        placeholder="Search locations..."
        [value]="searchQuery()"
        (input)="onSearchChange($any($event.target).value)"
        (keyup.escape)="clearSearch()"
        (keyup.enter)="onSearchSubmit()"
      />
      <div class="search-results" *ngIf="showSearchResults() && searchQuery()">
        <div class="result-item" *ngIf="!searchResults().length">
          <span class="no-results">No cities match your search</span>
        </div>
        <div class="result-item" *ngFor="let result of searchResults()" (click)="selectSearchResult(result)">
          <span class="result-name">{{ result.name }}</span>
          <span class="result-country">{{ result.country }}</span>
        </div>
      </div>
    </div>

    <!-- Nav Items -->
    <div class="nav-items" [class.open]="mobileMenuOpen()">
      <button
        class="nav-item"
        [class.active]="activeNav() === 'home'"
        routerLink="/"
        (click)="setActive('home'); closeMobileMenu()"
      >
        Home
      </button>
      <button
        class="nav-item"
        [class.active]="activeNav() === 'explore'"
        routerLink="/explore"
        (click)="setActive('explore'); closeMobileMenu()"
      >
        Explore
      </button>
      <button
        class="nav-item"
        [class.active]="activeNav() === 'voyager'"
        routerLink="/voyager"
        (click)="setActive('voyager'); closeMobileMenu()"
      >
        Voyager
      </button>
      <button
        class="nav-item"
        [class.active]="activeNav() === 'comparateur'"
        routerLink="/comparateur"
        (click)="setActive('comparateur'); closeMobileMenu()"
      >
        Comparateur
      </button>
      <button
        *ngIf="loggedIn()"
        class="nav-item"
        [class.active]="activeNav() === 'favourites'"
        routerLink="/favourites"
        (click)="setActive('favourites'); closeMobileMenu()"
      >
        Favourites
      </button>

      <!-- Auth links in mobile menu -->
      <ng-container *ngIf="!loggedIn()">
        <button class="nav-item" routerLink="/login" (click)="closeMobileMenu()">
          Sign in
        </button>
        <button class="nav-item" routerLink="/register" (click)="closeMobileMenu()">
          Sign up
        </button>
      </ng-container>
    </div>

    <!-- Auth Actions (Desktop & Profile) -->
    <div class="auth-actions">
      <ng-container *ngIf="!loggedIn()">
        <a class="nav-link" routerLink="/login">Sign in</a>
        <a class="nav-link signup" routerLink="/register">Sign up</a>
      </ng-container>

      <div class="profile-pic" *ngIf="loggedIn()" (click)="toggleProfileMenu($event)">
        <img
          *ngIf="profileUrl()"
          [src]="profileUrl()"
          alt="Profile"
          class="profile-image"
          (error)="onProfileImageError()"
        />
        <div *ngIf="!profileUrl()" class="profile-initial">{{ userInitial() }}</div>

        <div class="profile-menu" *ngIf="showProfileMenu()" (click)="$event.stopPropagation()">
          <a class="menu-item" (click)="goAccount($event)">Account</a>
          <a class="menu-item" *ngIf="isAdmin()" routerLink="/admin" (click)="showProfileMenu.set(false)">Admin Dashboard</a>
          <a class="menu-item" (click)="signOut()">Sign out</a>
        </div>
      </div>
    </div>
  </div>
</nav>